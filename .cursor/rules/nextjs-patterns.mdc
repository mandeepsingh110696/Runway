---
description: Next.js App Router patterns and conventions
globs: "src/app/**/*"
alwaysApply: false
---

# Next.js App Router Patterns

## File Conventions

- `page.tsx` — Route UI
- `layout.tsx` — Shared layout
- `loading.tsx` — Loading UI (Suspense)
- `error.tsx` — Error boundary
- `route.ts` — API route handler

## Server Components First

```typescript
// ✅ Server Component (default) — no directive needed
async function Page() {
  const data = await fetchData() // Direct async/await
  return <div>{data.title}</div>
}
```

## Client Components Only When Needed

```typescript
'use client' // Only add when required

// Required for: useState, useEffect, event handlers, browser APIs
function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(c => c + 1)}>{count}</button>
}
```

## Suspense Boundaries

```typescript
// ✅ Stream content, show layout immediately
function Page() {
  return (
    <div>
      <Header /> {/* Shows immediately */}
      <Suspense fallback={<Skeleton />}>
        <AsyncContent /> {/* Streams in */}
      </Suspense>
    </div>
  )
}
```

## Route Handlers (API)

```typescript
// src/app/api/example/route.ts
export async function GET(request: Request) {
  // Authenticate first
  const session = await auth()
  if (!session) return Response.json({ error: 'Unauthorized' }, { status: 401 })
  
  const data = await fetchData()
  return Response.json(data)
}
```

## Minimize Serialization

```typescript
// ❌ BAD: Passes entire object
<ClientComponent user={user} /> // user has 50 fields

// ✅ GOOD: Pass only needed fields
<ClientComponent name={user.name} avatar={user.avatar} />
```
